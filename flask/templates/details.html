{% extends "default_page.html" %}
{% block content %}
<link rel="icon" type="image/png" href="static/images/saga_scroll.webp">
{% if "username" in session %}

<main class="col-sm-12 col-xs-12 main main-expand-lg bg-body-tertiary">
    <div class="card bg-dark mb-3" style="margin: auto; max-width: 100rem;">
        <div class="card mb-3">
            <img src="{{ url_for('static', filename='images/' + novel.cover_image) }}" class="round-circle"
                alt="Book Cover" style="width: 200px; height: 200px; margin: 25px 43%;">
            <div class="card-body">
                <h2 class="card-title text-center"><strong>{{ novel.novel_title }}</strong></h2>
                <p class="card-text text-muted">Description:<i>{{ novel.description }}</i></p>
                <p class="card-text text-muted">Genre: <i>{{ novel.genre }}</i></p>
                <p class="card-text text-muted">Theme: <i>{{ novel.theme }}</i></p>
                <p class="card-text"><small class="text-muted">{{ novel.publish_date }}</small></p>
                <button class="btn btn-outline-warning save-btn" data-novel-id="{{ novel.novel_id }}">
                    ðŸ“š Save to Booklist
                </button>
                <p class="text-center" style="font: 220% 'Georgia';">Chapter 1</p>
                <p class="card-text text-center container-fluid">{{ novel.chapters }}</p>
            </div>
        </div>
    </div>

    <!-- Reviews Section -->
    <div class="container">
        <h3>Reviews & Comments</h3>
        {% if reviews %}
        {% for review in reviews %}
        <div class="review">
            <p><img src="{{ url_for('static', filename='images/' + review.profile_photo) }}" alt="User Photo"
                    class="rounded-circle w-2 h-auto border border-primary"
                    style="width: 30px; height: 30px; object-fit: cover;">

                <!-- <img src="{{ url_for('static', filename='uploaded_profile_photos/' + review.profile_photo) }}"
                    class="rounded-circle" alt="Profile Photo" width="10" height="10"> -->

                <strong>{{ review.username }}</strong>

            <p>{{ review.review_text }}</p>
            </p>
            <p><sub>{{ review.publish_time }}</sub></p>
        </div>
        {% endfor %}
        {% else %}
        <p>No reviews yet. Be the first to comment!</p>
        {% endif %}

        <!-- Comment Form (Only for Logged-In Users) -->
        <div class="card mt-4">
            <div class="card-body">
                <h5 class="card-title">Add a Comment</h5>
                <form method="POST">
                    <div class="form-group">
                        <label for="content">Your Comment:</label>
                        <textarea class="form-control" id="content" name="content" rows="3" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary mt-2">Post Comment</button>
                </form>
            </div>
        </div>
        {% else %}
        <p> <button class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#loginModal"
                class="nav-item">Login</button> to Read a novel and add A comment </p>
        {% endif %}
    </div>

</main>

<style>
    #wrapper {
        background-color: whitesmoke;
        padding: 0.5em;
    }

    nav {
        height: auto;
        background-color: #8b5a2b;
    }

    #footer {
        height: auto;
        background-color: #8b5a2b;
    }

    main {
        background-color: #f5deb3;
        height: auto;
    }

    li {
        color: black;
    }

    #myDIV>p {
        color: #f5deb3;
    }

    h4,
    h3 {
        color: #8b5a2b;
    }

    img {
        height: auto;
        width: 20%;
    }

    .nav-item a:hover {
        background-color: #1e1e2e;
        border-radius: 5px;
    }

    label>p {
        color: black;
    }

    .nav-item a {
        font-weight: 500;
    }
</style>
<script>
    document.querySelectorAll(".save-btn").forEach(button => {
        button.addEventListener("click", () => {
            const novelId = button.getAttribute("data-novel-id");

            fetch(`/save_novel/${novelId}`, {
                method: "POST"
            }).then(res => res.json())
                .then(data => {
                    if (data.status === "saved") {
                        button.textContent = "âœ… Saved to Booklist";
                        button.classList.remove("btn-outline-warning");
                        button.classList.add("btn-success");
                    }
                });
        });
    });
</script>

{% endblock %}